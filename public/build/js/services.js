document.addEventListener("DOMContentLoaded",()=>{initServices()});const initServices=()=>{initModal()},initModal=()=>{document.querySelector("#createService").addEventListener("click",()=>{openModal()});document.querySelectorAll("[name='serviceUpdate']").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.id,c=e.target.dataset.servicename,r=e.target.dataset.serviceprice;openModal(t,c,r)})});const e=document.querySelector("dialog");document.querySelector("#cancel-modal").addEventListener("click",()=>{e.close()}),e.addEventListener("click",t=>{const c=e.getBoundingClientRect();(t.clientX<c.left||t.clientX>c.right||t.clientY<c.top||t.clientY>c.bottom)&&e.close()}),submitBtn=document.querySelector("#submit-modal"),submitBtn.addEventListener("click",()=>{const e=document.querySelector("#dialogServiceId").value,t=document.querySelector("#dialogServiceName").value,c=document.querySelector("#dialogServicePrice").value;saveService(e,t,c)})},openModal=(e=0,t="",c="")=>{const r=document.querySelector("#dialogServiceId"),i=document.querySelector("#dialogServiceName"),n=document.querySelector("#dialogServicePrice");r.value=e,i.value=t,n.value=c,document.querySelector("dialog").showModal()},saveService=async(e,t,c)=>{const r=new FormData;r.append("id",e),r.append("serviceName",t),r.append("price",c);try{const t=await fetch("/api/saveService",{method:"POST",body:r}),c=await t.json();let i,n;if("0"!==e?(i=c.result,n="actualizado"):(i=c.result.resultado,n="creado"),document.querySelector("dialog").close(),i)Swal.fire({icon:"success",title:"Servicio "+n,text:`Servicio ${n} correctamente!`}).then(()=>{console.log("llego"),renderService(c.service)});else{let e="";c.errors.forEach(t=>{e+=`<li>${t}</li>`}),console.log(e),Swal.fire({icon:"error",title:"Error",html:`\n                    Ocurrieron los siguientes errores:\n                    <ul><b>${e}</b></ul>\n                `})}}catch(e){Swal.fire({icon:"error",title:"Error",text:"OcurriÃ³ un error guardando el servicio - "+e})}},renderService=e=>{const{id:t,serviceName:c,price:r}=e;let i=Array.from(document.querySelectorAll("ul[id='service-list'] li")).find(e=>e.dataset.serviceId===t);if(i)i.innerHTML=`\n            <p><span>Nombre:</span> <span class="service-desc">${c}</span></p>\n            <p><span>Precio:</span> $ <span class="service-desc">${r}</span></p>\n            <div class="buttons-container">\n                <input type="button" class="button" value="Actualizar servicio" name="serviceUpdate" data-id="${t}" data-serviceName="${c}" data-servicePrice="${r}">\n                \n                <input type="button" class="button-delete" value="Eliminar servicio" name="serviceDelete" data-id="${t}">\n            </div>\n        `;else{const e=`\n            <li data-service-id="${t}">\n                <p><span>Nombre:</span> <span class="service-desc">${c}</span></p>\n                <p><span>Precio:</span> $ <span class="service-desc">${r}</span></p>\n                <div class="buttons-container">\n                    <input type="button" class="button" value="Actualizar servicio" name="serviceUpdate" data-id="${t}" data-serviceName="${c}" data-servicePrice="${r}">\n                    \n                    <input type="button" class="button-delete" value="Eliminar servicio" name="serviceDelete" data-id="${t}">\n                </div>\n            </li>\n            <hr>\n        `;document.querySelector("#service-list").insertAdjacentHTML("beforeend",e)}};